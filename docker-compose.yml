version: '3.8'
services:
  tidal-dl:
    build: .
    image: ncrosty58/tidal-dl:latest
    ports:
      - "${HOST_PORT:-5050}:${CONTAINER_PORT:-5050}"
    # Example: mount a system config so the container reads /etc/tidal-dl/config.toml
    # The app will prefer environment variables over TOML; to allow TOML values
    # to be used for most settings, only set the env vars you explicitly want
    # to override here (leave others unset so they fall back to the TOML file).
    volumes:
      # Map a repository/local config (read-only) into the container
      - ./config.production.toml:/etc/tidal-dl/config.toml:ro
    environment:
      # We intentionally set only the runtime host/port here so the TOML file
      # can provide defaults for other settings like `TIDAL_DL_BIN` or
      # `DOWNLOAD_TOKEN` unless explicitly overridden.
      FLASK_HOST: "${FLASK_HOST:-0.0.0.0}"
      FLASK_PORT: "${CONTAINER_PORT:-5050}"
      # Do NOT set these here if you want the TOML values to take effect:
      # TIDAL_DL_BIN: "${TIDAL_DL_BIN:-tidal-dl-ng}"
      # DOWNLOAD_TIMEOUT: "${DOWNLOAD_TIMEOUT:-0}"
      # DOWNLOAD_TOKEN: "${DOWNLOAD_TOKEN:-}"
    restart: unless-stopped
